encode {
	# 启用压缩
	gzip
	zstd

	match {
		header Content-Type text/*
		header Content-Type application/json*
		# 启用对 WASM 的压缩
		header Content-Type application/wasm*
		header Content-Type application/javascript*
		header Content-Type application/xhtml+xml*
		header Content-Type application/atom+xml*
		header Content-Type application/rss+xml*
		header Content-Type image/svg+xml*
	}
}

# 代理 /api 路径的请求
handle /api/* {
	# 在发送前去掉请求前缀的 `/api`，因为服务端的api里没有这个路径
	uri strip_prefix /api
	reverse_proxy localhost:12345
}

handle {
	root dist

	# 把所有请求都转发到 index.html ，让 WASM 来处理 route
	try_files {path} /index.html
	file_server
}